import{_ as i,c as s,o as a,a6 as n}from"./chunks/framework.DmJO695r.js";const e="/aws/images/image18.png",y=JSON.parse('{"title":"Configuring Nginx on an EC2 Instance","description":"","frontmatter":{},"headers":[],"relativePath":"docs/ec2/05-nginx-configuration.md","filePath":"docs/ec2/05-nginx-configuration.md","lastUpdated":1722885547000}'),t={name:"docs/ec2/05-nginx-configuration.md"},l=n(`<h1 id="configuring-nginx-on-an-ec2-instance" tabindex="-1">Configuring Nginx on an EC2 Instance <a class="header-anchor" href="#configuring-nginx-on-an-ec2-instance" aria-label="Permalink to &quot;Configuring Nginx on an EC2 Instance&quot;">​</a></h1><p>In this guide, you will learn how to configure Nginx on an EC2 instance. Nginx is a popular web server that is commonly used to host web applications and serve static content.</p><h2 id="prerequisites" tabindex="-1">Prerequisites <a class="header-anchor" href="#prerequisites" aria-label="Permalink to &quot;Prerequisites&quot;">​</a></h2><p>Before you can configure Nginx on an EC2 instance, you need to have the following:</p><ul><li>An EC2 instance running in your AWS account</li><li>Nginx installed on your EC2 instance</li><li>SSH access to your EC2 instance</li></ul><h2 id="assumptions" tabindex="-1">Assumptions <a class="header-anchor" href="#assumptions" aria-label="Permalink to &quot;Assumptions&quot;">​</a></h2><ul><li>You have a domain name that you want to use to access your web application</li><li>You have an SSL certificate for your domain name</li><li>You have a web application running on your EC2 instance on a specific port</li></ul><p>If any of these assumptions are missing, refer to the following guides:</p><ul><li><a href="/aws/docs/cloudflare/00-cloudflare-overview.html">Setting up Your Domain with Cloudflare</a></li><li><a href="/aws/docs/cloudflare/01-cloudflare-ssl.html">Connecting Cloudflare SSL Certificates on an EC2 Instance</a></li><li><a href="/aws/docs/docker/00-docker-overview.html">Dockerizing and Hosting a Web Application on an EC2 Instance</a></li></ul><h2 id="configuring-nginx" tabindex="-1">Configuring Nginx <a class="header-anchor" href="#configuring-nginx" aria-label="Permalink to &quot;Configuring Nginx&quot;">​</a></h2><p>To configure Nginx on an EC2 instance, follow these steps:</p><ol><li><p>Connect to your EC2 instance using SSH. If you need help with this step, refer to the <a href="/aws/docs/ec2/02-connecting-to-ec2.html">Connecting to an EC2 Instance</a> guide.</p></li><li><p>Navigate to the Nginx configuration directory by running the following command:</p></li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/nginx/sites-available</span></span></code></pre></div><ol start="3"><li>Create a new configuration file for your web application by running the following command:</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nano</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mywebapp</span></span></code></pre></div><ol start="4"><li>In the Nano text editor, add the following configuration block for your web application: Be sure to replace <code>&lt;your-domain&gt;</code>, <code>&lt;subdomain&gt;</code>, and <code>&lt;APPLICATION_PORT&gt;</code> with your actual domain name, subdomain, and application port. Take note of the highlighted lines in the code block below for customization.</li></ol><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark has-focused-lines vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  listen </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">80</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  listen </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[::]:80;</span></span>
<span class="line has-focus"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  server_name </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.&lt;your-domain&gt;.com; </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 301</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> https://$server_name$request_uri;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    listen </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">443</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ssl http2;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    listen </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[::]:443 ssl http2;</span></span>
<span class="line has-focus"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ssl_certificate </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/etc/ssl/cert.pem; </span></span>
<span class="line has-focus"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ssl_certificate_key </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/etc/ssl/key.pem; </span></span>
<span class="line"></span>
<span class="line has-focus"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    server_name </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;subdomain&gt;.&lt;your-domain&gt;.com; </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> / </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line has-focus"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        proxy_pass </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">http://127.0.0.1:&lt;APPLICATION_PORT&gt;; </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        proxy_http_version </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        proxy_set_header </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Upgrade $http_upgrade;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        proxy_set_header </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Connection </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;upgrade&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        proxy_set_header </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Host $host;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        proxy_set_header </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">X-Real-IP $remote_addr;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        proxy_set_header </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">X-Forwarded-For $proxy_add_x_forwarded_for;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        proxy_set_header </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">X-Forwarded-Proto $scheme;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        proxy_read_timeout </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">86400</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><ol start="5"><li><p>Save and exit the Nano text editor by pressing <code>Ctrl + X</code>, then <code>Y</code>, and finally <code>Enter</code>.</p></li><li><p>Create a symbolic link to enable the new configuration file by running the following command:</p></li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ln</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/nginx/sites-available/mywebapp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/nginx/sites-enabled/</span></span></code></pre></div><ol start="7"><li>Test the Nginx configuration for syntax errors by running the following command:</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nginx</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -t</span></span></code></pre></div><ol start="8"><li>If there are no syntax errors, reload the Nginx service to apply the new configuration by running the following command:</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> reload</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nginx</span></span></code></pre></div><h2 id="installing-external-ssl-certificates" tabindex="-1">Installing External SSL Certificates <a class="header-anchor" href="#installing-external-ssl-certificates" aria-label="Permalink to &quot;Installing External SSL Certificates&quot;">​</a></h2><blockquote><p><a href="/aws/docs/cloudflare/00-cloudflare-overview.html">First time Domain Setup</a></p></blockquote><p>If you are using an external SSL certificate provider, you will need to install the SSL certificate and key on your EC2 instance. You can do this by following these steps:</p><ol><li>Copy the SSL certificate and key files to your EC2 instance.</li></ol><ul><li>If you are logged in to your EC2 instance, you can use the <code>scp</code> command to copy the files from your local machine to your EC2 instance. Replace <code>&lt;path-to-cert&gt;</code> and <code>&lt;path-to-key&gt;</code> with</li><li>Using the <code>scp</code> command. Replace <code>&lt;path-to-cert&gt;</code> and <code>&lt;path-to-key&gt;</code> with the paths to your SSL certificate and key files.</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">scp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">path-to-key-pai</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">r</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">path-to-cer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">t</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ubuntu@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">your-ec2-public-i</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">p</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:/etc/ssl/cert.pem</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">scp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">path-to-key-pai</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">r</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">path-to-ke</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">y</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ubuntu@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">your-ec2-public-i</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">p</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:/etc/ssl/key.pem</span></span></code></pre></div><ol start="2"><li>Update the SSL certificate and key paths in the Nginx configuration file by editing the file with the <code>nano</code> command:</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nano</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/nginx/sites-available/mywebapp</span></span></code></pre></div><ol start="3"><li><p>Update the <code>ssl_certificate</code> and <code>ssl_certificate_key</code> lines with the correct paths to your SSL certificate and key files.</p></li><li><p>Save and exit the Nano text editor by pressing <code>Ctrl + X</code>, then <code>Y</code>, and finally <code>Enter</code>.</p></li><li><p>Test the Nginx configuration for syntax errors by running the following command:</p></li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nginx</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -t</span></span></code></pre></div><p><img src="`+e+'" alt="image"></p><p>Before you can access your web application, you need to configure your domain name to point to your EC2 instance&#39;s public IP address. You can do this by updating the DNS records for your domain name in your DNS provider&#39;s control panel.</p><details><summary>Configuring Route 53 for Your Domain</summary><h3 id="optional-configuring-route-53-for-your-domain" tabindex="-1">[optional] Configuring Route 53 for Your Domain <a class="header-anchor" href="#optional-configuring-route-53-for-your-domain" aria-label="Permalink to &quot;[optional] Configuring Route 53 for Your Domain&quot;">​</a></h3><p>If you are using Amazon Route 53 as your DNS provider instead of cloudflare, you can configure your domain name to point to your EC2 instance by following these steps:</p><p>note that you will need to have your domain hosted on Route 53 to follow these steps. You will also need to have an Elastic IP address associated with your EC2 instance. If you don&#39;t have an Elastic IP address, you can follow the steps in the <a href="/aws/docs/ec2/01-create-an-instance.html#setting-up-elastic-ip">Setting up Elastic IP</a> guide.</p><p>You will also need to update the nginx configuration file to use the Elastic IP address and ssl certs.</p><ol><li><p>Open the <a href="https://console.aws.amazon.com/route53/" target="_blank" rel="noreferrer">Route 53 console</a>.</p></li><li><p>In the navigation pane, choose <code>Hosted zones</code>.</p></li><li><p>Choose the domain name that you want to configure.</p></li><li><p>Choose <code>Create record</code>.</p></li><li><p>In the <code>Create record</code> dialog box, configure the following settings:</p><ul><li><strong>Record name</strong> - Enter the subdomain that you want to use for your web application (e.g., <code>www</code> ).</li><li><strong>Record type</strong> - Choose <code>A - IPv4 address</code> .</li><li><strong>Value/Route traffic to</strong> - Choose <code>Alias to EC2 instance</code> and select your EC2 instance from the list.</li></ul></li><li><p>Choose <code>Create records</code>.</p></li><li><p>Wait for the changes to propagate. You can verify that your domain name is pointing to your EC2 instance by running the following command in your terminal:</p></li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nslookup</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">subdomai</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">n</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">your-domai</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">n</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.com</span></span></code></pre></div></details><blockquote><p>Verify that your web application is accessible by visiting <code>https://&lt;subdomain&gt;.&lt;your-domain&gt;.com</code> in a web browser. You should see your web application running on your EC2 instance.</p></blockquote>',37),o=[l];function h(p,r,d,c,k,g){return a(),s("div",null,o)}const E=i(t,[["render",h]]);export{y as __pageData,E as default};
